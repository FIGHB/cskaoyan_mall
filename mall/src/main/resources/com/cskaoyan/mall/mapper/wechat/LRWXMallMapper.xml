<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cskaoyan.mall.mapper.wechat.LRWXMallMapper">
    <!--author 李锐-->

    <select id="queryCategoryList" resultType="com.cskaoyan.mall.bean.Category">
        select add_time addTime, deleted, `desc`, icon_url iconUrl, id,
        keywords, `level`, `name`, pic_url picUrl, pid, sort_order sortOrder
        from cskaoyan_mall_category where pid = 0 and deleted = false
    </select>

    <select id="queryFirstLevel1Category" resultType="com.cskaoyan.mall.bean.Category">
        select add_time addTime, deleted, `desc`, icon_url iconUrl, id,
        keywords, `level`, `name`, pic_url picUrl, pid, sort_order sortOrder
        from cskaoyan_mall_category where pid = 0 and deleted = false limit 0, 1
    </select>

    <select id="queryCurrentSubCategory"  resultType="com.cskaoyan.mall.bean.Category">
        select add_time addTime, deleted, `desc`, icon_url iconUrl, id,
        keywords, `level`, `name`, pic_url picUrl, pid, sort_order sortOrder
        from cskaoyan_mall_category where pid = #{pid} and deleted = false
    </select>

    <select id="queryDefaultKeyword" resultType="com.cskaoyan.mall.bean.Keyword">
        select id, add_time addTime, deleted, is_default isDefault, is_hot isHot,
        keyword, sort_order sortOrder, update_time updateTime, `url`
        from cskaoyan_mall_keyword where is_default = true and deleted = false
        limit 0, 1
    </select>

    <select id="queryHotKeywordList" resultType="com.cskaoyan.mall.bean.Keyword">
        select id, add_time addTime, deleted, is_default isDefault, is_hot isHot,
        keyword, sort_order sortOrder, update_time updateTime, `url`
        from cskaoyan_mall_keyword where is_hot = true and deleted = false
    </select>

    <select id="queryOrdersByUserAndStatus" resultType="com.cskaoyan.mall.bean.Order">
        select id, user_id userId, order_status orderStatus, order_sn orderSn
        from cskaoyan_mall_order
        where user_id = #{userId} and order_status = #{status} and deleted = false
    </select>

    <select id="queryCommentStatusByOrderId" resultType="int">
        select `comment` from cskaoyan_mall_order_goods
        where order_id = #{orderId} and deleted = false
    </select>

    <select id="queryMyCouponListByStatus" resultType="com.cskaoyan.mall.bean.wechat.UserCouponBean">
         select cu.id id, `desc`, `discount`, cu.end_time endTime, `min`, name, cu.start_time StartTime, tag
        from cskaoyan_mall_coupon c left join cskaoyan_mall_coupon_user cu on coupon_id = c.id
        where user_id = #{userId} and cu.status = #{status} and c.deleted = false and cu.deleted = false
    </select>

    <select id="queryCouponehaded" resultType="int">
        select count(*) from cskaoyan_mall_coupon_user
        where user_id = #{userId} and coupon_id = #{couponId} and deleted = false
    </select>

    <insert id="addCouponForUser">
        insert into cskaoyan_mall_coupon_user
         (user_id, coupon_id, status, start_time, end_time, add_time, update_time, deleted)
        values
        (#{userId}, #{couponId}, 0, #{startTime}, #{endTime}, #{addTime},  #{addTime}, false)
    </insert>

    <select id="queryCouponById" resultType="com.cskaoyan.mall.bean.Coupon">
        select id, `total`, start_time startTime, end_time endTime, deleted from
        cskaoyan_mall_coupon where id = #{couponId} and deleted = false
    </select>

    <select id="queryGoodsProductById" resultType="com.cskaoyan.mall.bean.GoodsProduct">
        select specifications, `price`, `url`
        from cskaoyan_mall_goods_product where goods_id = #{goodsId} and deleted = false
    </select>

    <insert id="insertCart">
        insert into cskaoyan_mall_cart
        (user_id, goods_sn, goods_name, product_id, `price`, `number`, `specifications`, pic_url,add_time,update_time)
        values
        (#{userId}, #{goodsSn},#{goodsName},#{productId},#{price},#{number},#{specifications},
        #{picUrl},#{addTime},#{updateTime})
    </insert>

    <select id="queryDefaultAddressByUserId" resultMap="addressMap">
        select * from cskaoyan_mall_address where user_id = #{userId} and is_default = true and deleted = false
    </select>

    <select id="queryAddressByAddressId" resultMap="addressMap">
        select * from cskaoyan_mall_address where id = #{addressId} and deleted = false
    </select>

    <resultMap id="addressMap" type="com.cskaoyan.mall.bean.Address">
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="user_id" property="userId"/>
        <result column="province_id" property="provinceId"/>
        <result column="city_id" property="cityId"/>
        <result column="address" property="address"/>
        <result column="mobile" property="mobile"/>
        <result column="is_default" property="isDefault"/>
        <result column="add_time" property="addTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="deleted" property="deleted"/>
    </resultMap>

    <select id="queryCartById" resultMap="cartMap">
        select * from cskaoyan_mall_cart where id = #{cartId} and deleted = false
    </select>

    <resultMap id="cartMap" type="com.cskaoyan.mall.bean.Cart">
        <result column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="goods_id" property="goodsId"/>
        <result column="goods_sn" property="goodsSn"/>
        <result column="goods_name" property="goodsName"/>
        <result column="product_id" property="productId"/>
        <result column="price" property="price"/>
        <result column="number" property="number"/>
        <result column="specifications" property="specifications"/>
        <result column="checked" property="checked"/>
        <result column="pic_url" property="picUrl"/>
        <result column="add_time" property="addTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="deleted" property="deleted"/>
    </resultMap>

    <select id="queryCartByUserId" resultMap="cartMap">
        select * from cskaoyan_mall_cart where user_id = #{userId} and deleted = false
    </select>

</mapper>
